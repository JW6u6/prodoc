<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace ="com.prodoc.page.mapper.PageMapper">
  	<select id = "pageList" resultType = "String">
  		SELECT page_id
  		FROM tbl_page
  	</select>
  
  	<select id ="selectPageInfo" resultType="PageVO">
  		SELECT page_id
  		FROM tbl_page
  		WHERE page_id = #{pageId}
  	</select>
  	<!-- 등록 -->
  	<insert id="insertPage" parameterType="PageVO">
  		<selectKey keyProperty="pageId"
  				   resultType="String"
  				   order="BEFORE">
  		SELECT 'PAGE' || LPAD(NVL(MAX(TO_NUMBER(SUBSTR(page_id, -3))),0) + 1,3,'0')
  		FROM tbl_page
  		where page_id LIKE 'PAGE' || '___'
  		</selectKey>
  		INSERT INTO tbl_page
  				(
  					page_id
  					,work_id
  					,case_id
  					
  				)
  			VALUES
 				(
 					#{pageId}
 					,#{workId}
 					,#{caseId}
 				)
 	</insert>
 	
 	<!-- 페이지 잠금(관리자, 소유자) -->
 	<update id="LockPage" parameterType="PageVO">
 		UPDATE tbl_page
		SET lock_check = #{lockCheck}
		WHERE page_id = #{pageId}
 	</update>
 	
 	<!-- 페이지 삭제(체크) -->	
 	<update id="RemoveCheckPage" parameterType="String">
 		UPDATE tbl_page
 		SET delete_check = 'TRUE'
 		WHERE page_id = #{pageId}
 	</update>
 	
 	<!-- 페이지 알림 끄기 -->
 	<insert id="onOffPage" parameterType="PageVO" statementType="CALLABLE">
 		{call PAGENOTI_TOGGLE(
 								#{workId}
 								, #{pageId}
 								, #{email}
 								, #{result, mode=OUT, jdbcType=INTEGER, javaType=int}
 							)}
 	</insert>
 	
  </mapper>
  
  