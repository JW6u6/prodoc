<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prodoc.block.mapper.BlockMapper">
	<select id="selectAllBlock" resultType="BlockVO">
		SELECT *
		FROM TBL_DISPLAY
		WHERE PAGE_ID = #{pageId}
		order by parent_id DESC,row_x ASC
	</select>

	<insert id="insertBlock" parameterType="BlockVO">
		insert into tbl_display
		(display_id,page_id,row_x,block_id,cre_user,content)
		values
		(#{displayId},#{pageId},#{rowX},#{blockId},#{creUser},#{content})
	</insert>
	<update id="updateBlock" parameterType="BlockVO">
		update tbl_display
		set
		<choose>
		<when test="upUser != null">
		up_user = #{upUser}		
		</when>
		<otherwise>
		up_user = up_user
		</otherwise>
		</choose>
		,up_date = sysdate
		,parent_id = #{parentId}
		<if test="content != null">
			,content = #{content}
		</if>
		<if test="blockId != null">
			,block_id = #{blockId}
		</if>
		<if test="rowX != 0">
			,row_x = #{rowX}
		</if>
		<if test="colY != 0">
			,col_y = #{colY}
		</if>
		where display_id = #{displayId}
	</update>
	<delete id="deleteBlock" parameterType="BlockVO">
		delete from tbl_display
		where display_id = #{displayId}
	</delete>
	
	<insert id="createCheckBlock" statementType="CALLABLE" parameterType="hashMap">
		{call check_block(#{displayId, mode=IN,jdbcType=VARCHAR,javaType=string},
							#{checked, mode=IN,jdbcType=VARCHAR,javaType=string})}
	</insert>
	
</mapper>