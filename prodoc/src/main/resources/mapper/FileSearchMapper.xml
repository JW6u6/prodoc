<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.prodoc.file.mapper.FileSearchMapper">
	<!-- 파일검색 -->
	<select id="getFileList" resultType="SelectFileVO" parameterType="KeywordVO">
		SELECT *
		FROM view_file_list
		WHERE work_id IN (
            SELECT work_id
            FROM tbl_member
            WHERE email = #{email})
        <choose>
        	<when test="startDate != null">
        		AND save_date BETWEEN TO_DATE(#{startDate}, 'yyyy-MM-dd') AND TO_DATE(#{endDete}, 'yyyy-MM-dd')
        	</when>
        	<when test="keyword != null">
        	        AND( UPPER(up_name) LIKE UPPER('%'||#{keyword}||'%')
	                    OR UPPER(nickname) LIKE UPPER('%'||#{keyword}||'%')
	                    OR UPPER(page_name) LIKE UPPER('%'||#{keyword}||'%')
	                    OR UPPER(work_name) LIKE UPPER('%'||#{keyword}||'%')
                  		)
        	</when>
        </choose>
		ORDER BY save_date
	</select>
</mapper>