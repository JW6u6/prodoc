<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<!-- 해야 할 목록
□ 이미지 클릭 시 파일 업로드
■ 이메일 중복확인
■ 이메일 인증
■ 비밀번호 일치
□ 비밀번호 숫자 문자, 특수문자 3가지 입력받기
□ 전화번호 인증
□ 비밀번호 암호화
□ 회원가입 후 로그인창 이동
□ css
 -->
<body>
    <div>
	    <form id="joinForm" action="/join" method="post">
	    <div>
	        <img src="images/noneUser.jpg" id="profile" name="profile" style="width:200px">
	        <input type="file" accept="image/*" style="display: none;">
	    </div>
	    <div><!-- 이메일 -->
	        <input type="email" name="email" placeholder="*EMAIL" required>
	        <button type="button" id="emailCheck">중복확인</button>
	    </div>
	    <div>
	        <input type="text" name="authEmail" placeholder="*EMAIL 인증번호" readonly required>
	        <button type="button" id="authEmailCheck">인증확인</button>
	    </div>
		<div><!-- 비밀번호 -->
	        <input type="password" name="password" placeholder="*PASSWORD" required>
	        <input type="password" id="password" placeholder="*PASSWORD 확인" required>
	        <p style="color:red; display:none;">비밀번호가 일치하지 않습니다.</p>
	        <input type="text" name="nickName" placeholder="*이름" required>
		</div>
	    <div><!-- 연락처 -->
	    	<input type="text" name="phone" placeholder="*-없이 연락처 입력" required>
	        <button type="button" id="phoneCheck">번호전송</button>
	   	</div>
			
		<div>
	        <input type="text" name="authPhone" placeholder="*연락처 인증번호" required>
			<button type="button" id="authPhoneCheck">인증확인</button>
		</div>
		<div>
	        <input type="text" name="birth" placeholder="*생년월일 ex&#41;990101">
	        <button type="submit">회원가입</button>
		</div>
	    </form>
	</div>
</body>


<script th:inline="javascript">
let emailCheck = false; //이메일 중복체크
let emailAuth = false; //이메일 인증 체크
let passCheck = false;  //비밀번호 일치 체크
let phoneAuth = false; //휴대폰 인증 체크

//메일 중복체크
let mailBtn = document.getElementById("emailCheck"); 
mailBtn.addEventListener('click', function(e){
	let email = document.querySelector('input[name="email"]');
	if(email.value == ""){
		alert("이메일을 입력해주세요.");
		email.focus();  return;
	}
	
	fetch('/searchEmail', {
		method: "post",
		body: JSON.stringify({"email": email.value}),
		headers: {'content-Type' : 'application/json'}
	}).then(response => response.json())
	.then(result => {
		if(result.result){ 			//가입한 이메일
			alert('이미 가입된 이메일입니다.');
			email.value = "";
			email.focus();
			emailCheck = true; 	//중복 O
			return;
		}
		emailCheck = false; 	//중복 X
		serverNum = result.code //메일로 인증번호 발송
		let authEmail = document.querySelector('input[name="authEmail"]');
		authEmail.readOnly = emailCheck; //이메일 인증 번호 입력칸 readonly 해제
		alert('인증 메일이 발송되었습니다.');
	}).catch(err => console.log(err));
});

//메일 인증 확인
let mailAuthBtn = document.getElementById("authEmailCheck");
mailAuthBtn.addEventListener('click', function (e){
	let authNum = document.querySelector('input[name="authEmail"]');
	//console.log(serverNum);
	if(authNum.value == serverNum){ 
		emailAuth = true;
		alert("인증 성공");
	}else{
		emailAuth = false;
		alert("인증 실패");
	}
});

//비밀번호 일치 확인
let password = document.getElementById("password");
password.addEventListener('change', function(e){
	let pass = document.querySelector('input[name="password"]');
	let pTag = document.querySelector('p');
	if(pass.value == password.value) {
		passCheck = true;
		pTag.style.display = "none";
	}else {
		passCheck = false;
		pTag.style.display = "block";
	}
});


//전화번호 인증번호 전송
let phoneBtn = document.getElementById("phoneCheck");
phoneBtn.addEventListener('click', function(e){ 
	alert("인증번호 전송");
});

//전화번호 인증 확인
let phoneAuthBtn = document.getElementById("authPhoneCheck");
phoneAuthBtn.addEventListener('click', function(e){
	phoneAuth = true;
});
</script>
</html>