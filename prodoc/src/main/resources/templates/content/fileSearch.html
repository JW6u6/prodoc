<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="css/dbpage.css" rel="stylesheet" />
</head>
<body>
	<!-- 테스트 후 삭제하기(컨트롤러 포함) -->
<div>
	<button id="dbpagetest">page</button>
    <div data-container="container" id="pagecontainer">

    </div>

    <script type="text/javascript">
    	// test 임시데이터 : 메인 페이지 로드
        let container = document.querySelector('div[data-container="container"]');
    	document.getElementById("dbpagetest").addEventListener("click", e =>{
    		container.innerHTML = "";
            let url = '/pageInfo?pageId=' + 'aaaaa-bbbbb-cccccc';
            fetch(url)
            .then(response => response.json())
            .then(async result => {
                container.setAttribute("data-page-id", result.pageId);
                await getBlockList(result.pageId);
            })
            .catch(err => console.log(err));
        });
		
    	// test 임시데이터 : 메인 페이지 하위 블럭 가져오기
        function getBlockList(pageId){
            fetch("block/get", {
                method : "post",
                headers : {
                    "Content-Type" : "application/json"
                },
                body : JSON.stringify({ 'pageId' : pageId})
            })
            .then(response => response.json())
            .then( blockList => {
                 blockList.forEach( block => {
                    let divCase = document.createElement("div");
                    divCase.setAttribute("data-block-id", block.displayId);

                    // ✅ blockId가 DB일 때 DB블럭의 정보 가져오기
                    if(block.blockId == "DB"){
                        let createBlock = createDBblock(block);
                        container.insertAdjacentHTML("beforeend", createBlock);
                        getDBPageList(block.displayId);
                    }
                 });
            })
            .catch(err => console.log(err))
        }
        
    </script>
<script type="text/javascript" src="js/dbEvent.js"></script>
<script type="text/javascript" src="js/dbPageLayout.js"></script>
</div>

</body>
</html>

